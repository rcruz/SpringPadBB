(function(){var e,t,n,r,i,s,o,u,a,f,l,c={}.hasOwnProperty;l=/^(?:(\w+):\/\/)?(?:(\w+)(?::(\w+))?@)?([^:\/]+)?(?::(\d+))?(\/[^?#]*)?(?:\?([^#]*))?(?:#(.+))?/,f=["protocol","username","password","host","port","path","query","fragment"],s=typeof window!="undefined"&&window!==null?!1:!0,u=function(e){var t,n,r,i,s,o;if(!l.test(e))throw"Invalid uri";n=l.exec(e).slice(1),i={};for(t=s=0,o=f.length;s<o;t=++s)r=f[t],i[r]=n[t];return i},i=function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=function(e){return"[object Object]"===Object.prototype.toString.call(e)},r=function(e,t){var n,r;for(n in t){if(!c.call(t,n))continue;r=t[n],e[n]=r}},a=function(e){var t,n,r,s,u,a,f,l,c,h;n=/\[([^\]]*)\]/,t={},c=e.split("&");for(f=0,l=c.length;f<l;f++){s=c[f],h=s.split("="),r=h[0],a=h[1],u=n.exec(r),a=decodeURIComponent(a);if(!u){t[r]=a;continue}u[1]&&!o(t[r])?t[r]={}:i(t[r])||(t[r]=[]),u[1]?t[r][u[1]]=a:t[r].push(a)}return t},n=function(e,t){var n,r,s,u;if(!i(t)&&!o(t))return""+e+"="+encodeURIComponent(t);f=[];if(i(t))for(s=0,u=t.length;s<u;s++)n=t[s],f.push(""+e+"[]="+encodeURIComponent(n));if(o(t))for(r in t){if(!c.call(t,r))continue;n=t[r],f.push(""+e+"["+r+"]="+encodeURIComponent(n))}return f.join("&")},t="/",typeof window!="undefined"&&window!==null&&window.location.host&&(t=window.location.href),e=function(){function e(e){this.uri=e!=null?e:t,this.parts=u(this.uri),this.parts.query=this.parts.query?a(this.parts.query):{},this.parts.path||(this.parts.path="/");return}return e.prototype.retrieve=function(e,t){return t==null&&(t=null),t===null?this.parts[e]:(this.parts[e]=t,this)},e.prototype.protocol=function(e){return this.retrieve("protocol",e)},e.prototype.username=function(e){return this.retrieve("username",e)},e.prototype.password=function(e){return this.retrieve("password",e)},e.prototype.host=function(e){return this.retrieve("host",e)},e.prototype.port=function(e){return this.retrieve("port",e)},e.prototype.path=function(e){return e&&e[0]!=="/"&&(e="/"+e),this.retrieve("path",e)},e.prototype.query=function(e,t){return e&&typeof e=="string"?t?(this.parts.query[e]=t,this):this.parts.query[e]:o(e)?(r(this.parts.query,e),this):this.parts.query},e.prototype.fragment=function(e){return this.retrieve("fragment",e)},e.prototype.toString=function(){var e,t,r,i,s;r="",this.parts.protocol&&this.parts.host&&(r+=""+this.parts.protocol+"://",this.parts.username&&this.parts.password?r+=""+this.parts.username+":"+this.parts.password+"@":this.parts.username&&(r+=""+this.parts.username+"@"),r+=this.parts.host),r+=this.parts.path,t=[],s=this.parts.query;for(e in s){if(!c.call(s,e))continue;i=s[e],t.push(n(e,i))}return t.length>0&&(r+="?"+t.join("&")),this.parts.fragment&&(r+="#"+this.parts.fragment),r},e}(),s?module.exports=e:this.miuri=e}).call(this);